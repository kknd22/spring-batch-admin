<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:batch="http://www.springframework.org/schema/batch"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd">


    <bean id="requestAggregator"
          class="org.springframework.batch.execution.jms.partition.JmsStepExecutionRequestAggregator">
        <description>
            Component responsible to send the request(s) to remote workers and aggregate the result.
        </description>
        <property name="jobExplorer" ref="jobExplorer"/>
        <property name="jmsTemplate" ref="jmsTemplate"/>
        <property name="stepExecutionRequestQueueName" value="queue/stepExecutionRequest"/>
        <property name="stepExecutionTimeout" value="300"/>
    </bean>

    <bean id="partitioner" class="org.springframework.batch.core.partition.support.SimplePartitioner"/>

    <!-- A simple job that is configured properly -->
    <job id="job1" xmlns="http://www.springframework.org/schema/batch">
        <step id="step1-master">
            <partition handler="job1PartitionHandler" partitioner="partitioner"/>
        </step>
    </job>


    <step id="step1" xmlns="http://www.springframework.org/schema/batch">
        <tasklet>
            <chunk commit-interval="10">
                <reader>
                    <bean class="org.springframework.batch.integration.partition.ExampleItemReader" scope="step"
                          xmlns="http://www.springframework.org/schema/beans"/>
                </reader>
                <writer>
                    <bean class="org.springframework.batch.integration.partition.ExampleItemWriter"
                          xmlns="http://www.springframework.org/schema/beans"/>
                </writer>
            </chunk>
        </tasklet>
    </step>

    <bean id="job1PartitionHandler"
          class="org.springframework.batch.integration.partition.support.GenericPartitionHandler">
        <property name="gridSize" value="2"/>
        <property name="jobExplorer" ref="jobExplorer"/>
        <!-- This property specifies which step must be ran for the partition -->
        <property name="stepName" value="step1"/>
        <property name="requestAggregator" ref="requestAggregator"/>
    </bean>

     <!-- A simple job that is configured properly -->
    <job id="job2" xmlns="http://www.springframework.org/schema/batch">
        <step id="step2-master">
            <partition handler="job2PartitionHandler" partitioner="partitioner"/>
        </step>
    </job>

    <bean id="job2PartitionHandler"
          class="org.springframework.batch.integration.partition.support.GenericPartitionHandler">
        <property name="gridSize" value="2"/>
        <property name="jobExplorer" ref="jobExplorer"/>
        <!-- This property specifies which step must be ran for the partition. Here it is wrong, no such step exists -->
        <property name="stepName" value="unknownStep"/>
        <property name="requestAggregator" ref="requestAggregator"/>
    </bean>

</beans>